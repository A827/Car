<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Motoria • Dealers</title>
  <link rel="icon" href="favicon.svg" type="image/svg+xml" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- Header -->
  <header class="site-header" id="siteHeader">
    <div class="container header-inner">
      <a class="brand" href="index.html" aria-label="Motoria home">
        <svg class="logo" viewBox="0 0 64 64" aria-hidden="true">
          <rect x="4" y="20" width="56" height="24" rx="6"></rect>
          <circle cx="20" cy="48" r="6"></circle>
          <circle cx="48" cy="48" r="6"></circle>
        </svg>
        <span class="brand-name">Motoria</span>
      </a>
      <nav class="nav" aria-label="Primary">
        <button class="nav-toggle" id="navToggle" aria-expanded="false" aria-controls="navMenu" aria-label="Open menu">
          <span></span><span></span><span></span>
        </button>
        <ul id="navMenu" class="nav-menu">
          <li><a href="results.html">Buy</a></li>
          <li><a href="#">Sell</a></li>
          <li><a href="#">Finance</a></li>
          <li><a class="active" href="dealers.html">Dealers</a></li>
          <li class="divider" aria-hidden="true"></li>
          <li id="authSlot"></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="section">
    <div class="container">
      <div class="section-head">
        <h1 style="margin:0">Verified dealers</h1>
        <div class="row" style="gap:8px">
          <input id="dealerSearch" placeholder="Search dealers or city…" style="height:42px;border-radius:999px;border:1px solid var(--line);padding:0 12px;min-width:240px" />
          <select id="dealerFilter" style="height:42px;border-radius:999px;border:1px solid var(--line);padding:0 12px">
            <option value="">All dealers</option>
            <option value="promoted">Promoted only</option>
            <option value="verified">Verified only</option>
          </select>
        </div>
      </div>

      <div id="grid" class="cards" style="grid-template-columns:repeat(3,1fr);gap:16px"></div>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container footer-grid">
      <div>
        <div class="brand-footer">
          <svg class="logo" viewBox="0 0 64 64" aria-hidden="true">
            <rect x="4" y="20" width="56" height="24" rx="6"></rect>
            <circle cx="20" cy="48" r="6"></circle>
            <circle cx="48" cy="48" r="6"></circle>
          </svg>
          <span>Motoria</span>
        </div>
        <p class="muted">© <span id="year"></span> Motoria Ltd.</p>
      </div>
    </div>
  </footer>

  <script src="app.js"></script>
  <script src="data.js"></script>
  <script>
    // Header basics
    const header = document.getElementById('siteHeader');
    addEventListener('scroll',()=>header.classList.toggle('elevated', scrollY>6));
    const y = document.getElementById('year'); if (y) y.textContent = new Date().getFullYear();
    const navToggle=document.getElementById('navToggle');
    const navMenu=document.getElementById('navMenu');
    navToggle?.addEventListener('click',()=>{
      const exp = navToggle.getAttribute('aria-expanded')==='true';
      navToggle.setAttribute('aria-expanded', String(!exp));
      navMenu.classList.toggle('open');
    });

    // Dealer list
    const MD = window.MotoriaData;
    const grid = document.getElementById('grid');
    const qInput = document.getElementById('dealerSearch');
    const filter = document.getElementById('dealerFilter');

    function render(){
      const q = (qInput.value||'').toLowerCase().trim();
      const mode = filter.value;
      let dealers = MD.getDealers();

      // optional filters
      if (mode === 'promoted') dealers = dealers.filter(d=>d.promoted);
      if (mode === 'verified') dealers = dealers.filter(d=>d.verified);

      if (q){
        dealers = dealers.filter(d=>{
          const hay = [d.company,d.name,d.city,d.email].map(x=>String(x||'').toLowerCase()).join(' ');
          return hay.includes(q);
        });
      }

      // promoted first, then verified
      dealers.sort((a,b)=> (b.promoted - a.promoted) || (b.verified - a.verified) || (String(a.company||a.name).localeCompare(String(b.company||b.name))));

      grid.innerHTML = dealers.map(d=>`
        <article class="card ${d.verified?'verified':''} ${d.promoted?'promoted':''}">
          <div class="card-body">
            <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
              <h3 style="margin:0;font-size:18px">${d.company||d.name||'Dealer'}</h3>
              <div class="badges">
                ${d.promoted?'<span class="badge badge-promoted">Promoted</span>':''}
                ${d.verified?'<span class="badge badge-verified">Verified</span>':''}
              </div>
            </div>
            <div class="muted small" style="margin-top:6px">${d.city||''}${d.city&&d.country?', ':''}${d.country||''}</div>
            <div class="muted small">${d.email||''}</div>

            <div class="row" style="gap:8px;margin-top:10px">
              <a class="btn btn-primary" href="results.html?dealer_email=${encodeURIComponent(d.email||'')}">View listings</a>
              <a class="btn btn-ghost" href="results.html?dealer=${encodeURIComponent(d.company||d.name||'')}">Search by name</a>
            </div>
          </div>
        </article>
      `).join('') || '<div class="muted">No dealers found.</div>';
    }

    qInput.addEventListener('input', render);
    filter.addEventListener('change', render);
    render();
  </script>
</body>
</html>